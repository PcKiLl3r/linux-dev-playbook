---
- name: Setup Linux Development Machine Environment
  hosts: localhost
  connection: local
  become: true
  vars_files:
    - vault/become_pass.yml
    - vault/bluetooth.yml
    - config.yml

  vars:
    use_on_tv: false
    restore_last_ssh: true

  pre_tasks:
    - name: Include Vars
      ansible.builtin.include_vars:
        file: ./playbooks/vars.yml

    - name: Determine target operating system
      ansible.builtin.set_fact:
        target_os: "{{ os_override | default(ansible_distribution | lower) }}"

    - name: Include distro vars
      ansible.builtin.include_vars:
        file: "./playbooks/vars/{{ target_os }}.yml"

    - name: Show detected operating system
      ansible.builtin.debug:
        msg: "Installing for OS: {{ target_os }}"

    - name: Include Core init tasks
      ansible.builtin.include_tasks:
        file: ./playbooks/core.yml

        #    - name: Import GUI Apps Install
        #      ansible.builtin.include_tasks:
        #        file: ./playbooks/gui-software.yml
        #      become: false
        #
        #   - name: Import Mobile Dev Install
        #     ansible.builtin.include_tasks:
        #       file: ./playbooks/mobile-dev.yml
        #     become: false
        #
        #   TODE make more plays instead of 1 play with many tasks

  tasks:
    - name: Include SSH key restore/create
      ansible.builtin.include_tasks:
        file: ./playbooks/ssh.yml
      vars:
        machine_upgrade: "{{ restore_last_ssh }}"

    - name: Import Utility Packages Install
      ansible.builtin.import_tasks:
        file: ./playbooks/utils.yml

    - name: Import Dev-Tools Install
      ansible.builtin.import_tasks:
        file: ./playbooks/dev-tools.yml

    - name: Import Browser Install
      ansible.builtin.import_tasks:
        file: ./playbooks/browsers.yml

    - name: Import ZShell Install
      ansible.builtin.import_tasks:
        file: ./playbooks/zsh.yml

    - name: Import Programming Languages/Runtimes Install
      ansible.builtin.import_tasks:
        file: ./playbooks/prog-lang.yml

    - name: Import TMux Install
      ansible.builtin.import_tasks:
        file: ./playbooks/tmux.yml

    - name: Import NeoVim Install
      ansible.builtin.import_tasks:
        file: ./playbooks/neovim.yml

    - name: Import i3 Install
      ansible.builtin.import_tasks:
        file: ./playbooks/i3.yml

    - name: Import keyboard setup
      ansible.builtin.import_tasks:
        file: ./playbooks/keyboard.yml

    - name: Import Bluetooth & audio setup
      ansible.builtin.import_tasks:
        file: ./playbooks/bluetooth.yml

    - name: Import dotfiles setup
      ansible.builtin.import_tasks:
        file: ./playbooks/dotfiles.yml

    - name: Import machine preset overrides
      ansible.builtin.import_tasks:
        file: ./playbooks/presets.yml
