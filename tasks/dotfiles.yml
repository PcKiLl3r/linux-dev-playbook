---

- name: Install stow
  ansible.builtin.package:
    name: "{{ dotfiles_packages }}"
    state: present
    use: "{{ pkg_mgr }}"

- name: Clone dotfiles repo
  ansible.builtin.git:
    repo: "{{ dotfiles_repo }}"
    dest: "~/.dotfiles"
    version: master
    key_file: "{{ dotfiles_repo_key | default(omit, true) }}"
    recursive: "{{ dotfiles_repo_recursive | default(false) }}"
  become: true
  become_user: "{{ username }}"

- name: Stow .dotfiles
  ansible.builtin.command:
    cmd: ./run
    # creates:
  args:
    chdir: "/home/{{ username }}/.dotfiles"
  changed_when: false
  become: true
  become_user: "{{ username }}"
